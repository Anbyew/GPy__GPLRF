


<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    
    
    <meta http-equiv="X-UA-Compatible" content="IE=emulateIE7" />
    <title>Coverage for GPy/kern/src/kern.py: 32%</title>
    <link rel="stylesheet" href="style.css" type="text/css">
    
    <script type="text/javascript" src="jquery.min.js"></script>
    <script type="text/javascript" src="jquery.hotkeys.js"></script>
    <script type="text/javascript" src="jquery.isonscreen.js"></script>
    <script type="text/javascript" src="coverage_html.js"></script>
    <script type="text/javascript">
        jQuery(document).ready(coverage.pyfile_ready);
    </script>
</head>
<body class="pyfile">

<div id="header">
    <div class="content">
        <h1>Coverage for <b>GPy/kern/src/kern.py</b> :
            <span class="pc_cov">32%</span>
        </h1>

        <img id="keyboard_icon" src="keybd_closed.png" alt="Show keyboard shortcuts" />

        <h2 class="stats">
            158 statements &nbsp;
            <span class="run hide_run shortkey_r button_toggle_run">56 run</span>
            <span class="mis shortkey_m button_toggle_mis">102 missing</span>
            <span class="exc shortkey_x button_toggle_exc">24 excluded</span>

            
                <span class="par run hide_run shortkey_p button_toggle_par">0 partial</span>
            
        </h2>
    </div>
</div>

<div class="help_panel">
    <img id="panel_icon" src="keybd_open.png" alt="Hide keyboard shortcuts" />
    <p class="legend">Hot-keys on this page</p>
    <div>
    <p class="keyhelp">
        <span class="key">r</span>
        <span class="key">m</span>
        <span class="key">x</span>
        <span class="key">p</span> &nbsp; toggle line displays
    </p>
    <p class="keyhelp">
        <span class="key">j</span>
        <span class="key">k</span> &nbsp; next/prev highlighted chunk
    </p>
    <p class="keyhelp">
        <span class="key">0</span> &nbsp; (zero) top of page
    </p>
    <p class="keyhelp">
        <span class="key">1</span> &nbsp; (one) first highlighted chunk
    </p>
    </div>
</div>

<div id="source">
    <table>
        <tr>
            <td class="linenos">
<p id="n1" class="pln"><a href="#n1">1</a></p>
<p id="n2" class="pln"><a href="#n2">2</a></p>
<p id="n3" class="stm run hide_run"><a href="#n3">3</a></p>
<p id="n4" class="stm run hide_run"><a href="#n4">4</a></p>
<p id="n5" class="stm run hide_run"><a href="#n5">5</a></p>
<p id="n6" class="stm run hide_run"><a href="#n6">6</a></p>
<p id="n7" class="stm run hide_run"><a href="#n7">7</a></p>
<p id="n8" class="stm run hide_run"><a href="#n8">8</a></p>
<p id="n9" class="stm run hide_run"><a href="#n9">9</a></p>
<p id="n10" class="pln"><a href="#n10">10</a></p>
<p id="n11" class="stm run hide_run"><a href="#n11">11</a></p>
<p id="n12" class="stm run hide_run"><a href="#n12">12</a></p>
<p id="n13" class="pln"><a href="#n13">13</a></p>
<p id="n14" class="pln"><a href="#n14">14</a></p>
<p id="n15" class="pln"><a href="#n15">15</a></p>
<p id="n16" class="pln"><a href="#n16">16</a></p>
<p id="n17" class="pln"><a href="#n17">17</a></p>
<p id="n18" class="pln"><a href="#n18">18</a></p>
<p id="n19" class="pln"><a href="#n19">19</a></p>
<p id="n20" class="stm run hide_run"><a href="#n20">20</a></p>
<p id="n21" class="stm run hide_run"><a href="#n21">21</a></p>
<p id="n22" class="exc"><a href="#n22">22</a></p>
<p id="n23" class="pln"><a href="#n23">23</a></p>
<p id="n24" class="pln"><a href="#n24">24</a></p>
<p id="n25" class="pln"><a href="#n25">25</a></p>
<p id="n26" class="pln"><a href="#n26">26</a></p>
<p id="n27" class="pln"><a href="#n27">27</a></p>
<p id="n28" class="pln"><a href="#n28">28</a></p>
<p id="n29" class="pln"><a href="#n29">29</a></p>
<p id="n30" class="pln"><a href="#n30">30</a></p>
<p id="n31" class="pln"><a href="#n31">31</a></p>
<p id="n32" class="pln"><a href="#n32">32</a></p>
<p id="n33" class="pln"><a href="#n33">33</a></p>
<p id="n34" class="pln"><a href="#n34">34</a></p>
<p id="n35" class="pln"><a href="#n35">35</a></p>
<p id="n36" class="pln"><a href="#n36">36</a></p>
<p id="n37" class="pln"><a href="#n37">37</a></p>
<p id="n38" class="pln"><a href="#n38">38</a></p>
<p id="n39" class="pln"><a href="#n39">39</a></p>
<p id="n40" class="pln"><a href="#n40">40</a></p>
<p id="n41" class="pln"><a href="#n41">41</a></p>
<p id="n42" class="pln"><a href="#n42">42</a></p>
<p id="n43" class="pln"><a href="#n43">43</a></p>
<p id="n44" class="pln"><a href="#n44">44</a></p>
<p id="n45" class="stm mis"><a href="#n45">45</a></p>
<p id="n46" class="stm mis"><a href="#n46">46</a></p>
<p id="n47" class="pln"><a href="#n47">47</a></p>
<p id="n48" class="stm mis"><a href="#n48">48</a></p>
<p id="n49" class="stm mis"><a href="#n49">49</a></p>
<p id="n50" class="pln"><a href="#n50">50</a></p>
<p id="n51" class="stm mis"><a href="#n51">51</a></p>
<p id="n52" class="pln"><a href="#n52">52</a></p>
<p id="n53" class="stm mis"><a href="#n53">53</a></p>
<p id="n54" class="pln"><a href="#n54">54</a></p>
<p id="n55" class="stm mis"><a href="#n55">55</a></p>
<p id="n56" class="pln"><a href="#n56">56</a></p>
<p id="n57" class="stm mis"><a href="#n57">57</a></p>
<p id="n58" class="stm mis"><a href="#n58">58</a></p>
<p id="n59" class="pln"><a href="#n59">59</a></p>
<p id="n60" class="stm mis"><a href="#n60">60</a></p>
<p id="n61" class="stm mis"><a href="#n61">61</a></p>
<p id="n62" class="pln"><a href="#n62">62</a></p>
<p id="n63" class="stm run hide_run"><a href="#n63">63</a></p>
<p id="n64" class="stm mis"><a href="#n64">64</a></p>
<p id="n65" class="stm mis"><a href="#n65">65</a></p>
<p id="n66" class="stm mis"><a href="#n66">66</a></p>
<p id="n67" class="stm mis"><a href="#n67">67</a></p>
<p id="n68" class="pln"><a href="#n68">68</a></p>
<p id="n69" class="stm mis"><a href="#n69">69</a></p>
<p id="n70" class="stm mis"><a href="#n70">70</a></p>
<p id="n71" class="stm mis"><a href="#n71">71</a></p>
<p id="n72" class="stm mis"><a href="#n72">72</a></p>
<p id="n73" class="pln"><a href="#n73">73</a></p>
<p id="n74" class="stm run hide_run"><a href="#n74">74</a></p>
<p id="n75" class="exc"><a href="#n75">75</a></p>
<p id="n76" class="pln"><a href="#n76">76</a></p>
<p id="n77" class="stm run hide_run"><a href="#n77">77</a></p>
<p id="n78" class="pln"><a href="#n78">78</a></p>
<p id="n79" class="pln"><a href="#n79">79</a></p>
<p id="n80" class="pln"><a href="#n80">80</a></p>
<p id="n81" class="pln"><a href="#n81">81</a></p>
<p id="n82" class="pln"><a href="#n82">82</a></p>
<p id="n83" class="pln"><a href="#n83">83</a></p>
<p id="n84" class="pln"><a href="#n84">84</a></p>
<p id="n85" class="pln"><a href="#n85">85</a></p>
<p id="n86" class="pln"><a href="#n86">86</a></p>
<p id="n87" class="pln"><a href="#n87">87</a></p>
<p id="n88" class="pln"><a href="#n88">88</a></p>
<p id="n89" class="pln"><a href="#n89">89</a></p>
<p id="n90" class="pln"><a href="#n90">90</a></p>
<p id="n91" class="stm mis"><a href="#n91">91</a></p>
<p id="n92" class="stm mis"><a href="#n92">92</a></p>
<p id="n93" class="stm mis"><a href="#n93">93</a></p>
<p id="n94" class="stm mis"><a href="#n94">94</a></p>
<p id="n95" class="stm mis"><a href="#n95">95</a></p>
<p id="n96" class="stm mis"><a href="#n96">96</a></p>
<p id="n97" class="stm mis"><a href="#n97">97</a></p>
<p id="n98" class="pln"><a href="#n98">98</a></p>
<p id="n99" class="stm run hide_run"><a href="#n99">99</a></p>
<p id="n100" class="pln"><a href="#n100">100</a></p>
<p id="n101" class="stm mis"><a href="#n101">101</a></p>
<p id="n102" class="pln"><a href="#n102">102</a></p>
<p id="n103" class="pln"><a href="#n103">103</a></p>
<p id="n104" class="stm run hide_run"><a href="#n104">104</a></p>
<p id="n105" class="stm mis"><a href="#n105">105</a></p>
<p id="n106" class="stm mis"><a href="#n106">106</a></p>
<p id="n107" class="pln"><a href="#n107">107</a></p>
<p id="n108" class="stm run hide_run"><a href="#n108">108</a></p>
<p id="n109" class="pln"><a href="#n109">109</a></p>
<p id="n110" class="stm mis"><a href="#n110">110</a></p>
<p id="n111" class="pln"><a href="#n111">111</a></p>
<p id="n112" class="stm run hide_run"><a href="#n112">112</a></p>
<p id="n113" class="pln"><a href="#n113">113</a></p>
<p id="n114" class="stm mis"><a href="#n114">114</a></p>
<p id="n115" class="stm mis"><a href="#n115">115</a></p>
<p id="n116" class="exc"><a href="#n116">116</a></p>
<p id="n117" class="exc"><a href="#n117">117</a></p>
<p id="n118" class="pln"><a href="#n118">118</a></p>
<p id="n119" class="stm run hide_run"><a href="#n119">119</a></p>
<p id="n120" class="exc"><a href="#n120">120</a></p>
<p id="n121" class="pln"><a href="#n121">121</a></p>
<p id="n122" class="pln"><a href="#n122">122</a></p>
<p id="n123" class="pln"><a href="#n123">123</a></p>
<p id="n124" class="pln"><a href="#n124">124</a></p>
<p id="n125" class="pln"><a href="#n125">125</a></p>
<p id="n126" class="pln"><a href="#n126">126</a></p>
<p id="n127" class="pln"><a href="#n127">127</a></p>
<p id="n128" class="pln"><a href="#n128">128</a></p>
<p id="n129" class="pln"><a href="#n129">129</a></p>
<p id="n130" class="pln"><a href="#n130">130</a></p>
<p id="n131" class="exc"><a href="#n131">131</a></p>
<p id="n132" class="stm run hide_run"><a href="#n132">132</a></p>
<p id="n133" class="pln"><a href="#n133">133</a></p>
<p id="n134" class="pln"><a href="#n134">134</a></p>
<p id="n135" class="pln"><a href="#n135">135</a></p>
<p id="n136" class="pln"><a href="#n136">136</a></p>
<p id="n137" class="pln"><a href="#n137">137</a></p>
<p id="n138" class="pln"><a href="#n138">138</a></p>
<p id="n139" class="exc"><a href="#n139">139</a></p>
<p id="n140" class="stm run hide_run"><a href="#n140">140</a></p>
<p id="n141" class="pln"><a href="#n141">141</a></p>
<p id="n142" class="pln"><a href="#n142">142</a></p>
<p id="n143" class="pln"><a href="#n143">143</a></p>
<p id="n144" class="pln"><a href="#n144">144</a></p>
<p id="n145" class="stm mis"><a href="#n145">145</a></p>
<p id="n146" class="stm run hide_run"><a href="#n146">146</a></p>
<p id="n147" class="pln"><a href="#n147">147</a></p>
<p id="n148" class="pln"><a href="#n148">148</a></p>
<p id="n149" class="pln"><a href="#n149">149</a></p>
<p id="n150" class="pln"><a href="#n150">150</a></p>
<p id="n151" class="stm mis"><a href="#n151">151</a></p>
<p id="n152" class="stm run hide_run"><a href="#n152">152</a></p>
<p id="n153" class="pln"><a href="#n153">153</a></p>
<p id="n154" class="pln"><a href="#n154">154</a></p>
<p id="n155" class="pln"><a href="#n155">155</a></p>
<p id="n156" class="pln"><a href="#n156">156</a></p>
<p id="n157" class="stm mis"><a href="#n157">157</a></p>
<p id="n158" class="stm run hide_run"><a href="#n158">158</a></p>
<p id="n159" class="pln"><a href="#n159">159</a></p>
<p id="n160" class="pln"><a href="#n160">160</a></p>
<p id="n161" class="pln"><a href="#n161">161</a></p>
<p id="n162" class="pln"><a href="#n162">162</a></p>
<p id="n163" class="pln"><a href="#n163">163</a></p>
<p id="n164" class="pln"><a href="#n164">164</a></p>
<p id="n165" class="stm mis"><a href="#n165">165</a></p>
<p id="n166" class="stm run hide_run"><a href="#n166">166</a></p>
<p id="n167" class="pln"><a href="#n167">167</a></p>
<p id="n168" class="pln"><a href="#n168">168</a></p>
<p id="n169" class="pln"><a href="#n169">169</a></p>
<p id="n170" class="pln"><a href="#n170">170</a></p>
<p id="n171" class="pln"><a href="#n171">171</a></p>
<p id="n172" class="exc"><a href="#n172">172</a></p>
<p id="n173" class="stm run hide_run"><a href="#n173">173</a></p>
<p id="n174" class="stm mis"><a href="#n174">174</a></p>
<p id="n175" class="stm run hide_run"><a href="#n175">175</a></p>
<p id="n176" class="pln"><a href="#n176">176</a></p>
<p id="n177" class="pln"><a href="#n177">177</a></p>
<p id="n178" class="pln"><a href="#n178">178</a></p>
<p id="n179" class="pln"><a href="#n179">179</a></p>
<p id="n180" class="pln"><a href="#n180">180</a></p>
<p id="n181" class="exc"><a href="#n181">181</a></p>
<p id="n182" class="stm run hide_run"><a href="#n182">182</a></p>
<p id="n183" class="pln"><a href="#n183">183</a></p>
<p id="n184" class="pln"><a href="#n184">184</a></p>
<p id="n185" class="pln"><a href="#n185">185</a></p>
<p id="n186" class="exc"><a href="#n186">186</a></p>
<p id="n187" class="stm run hide_run"><a href="#n187">187</a></p>
<p id="n188" class="pln"><a href="#n188">188</a></p>
<p id="n189" class="pln"><a href="#n189">189</a></p>
<p id="n190" class="pln"><a href="#n190">190</a></p>
<p id="n191" class="exc"><a href="#n191">191</a></p>
<p id="n192" class="pln"><a href="#n192">192</a></p>
<p id="n193" class="stm run hide_run"><a href="#n193">193</a></p>
<p id="n194" class="pln"><a href="#n194">194</a></p>
<p id="n195" class="exc"><a href="#n195">195</a></p>
<p id="n196" class="pln"><a href="#n196">196</a></p>
<p id="n197" class="stm run hide_run"><a href="#n197">197</a></p>
<p id="n198" class="pln"><a href="#n198">198</a></p>
<p id="n199" class="exc"><a href="#n199">199</a></p>
<p id="n200" class="pln"><a href="#n200">200</a></p>
<p id="n201" class="stm run hide_run"><a href="#n201">201</a></p>
<p id="n202" class="exc"><a href="#n202">202</a></p>
<p id="n203" class="pln"><a href="#n203">203</a></p>
<p id="n204" class="stm run hide_run"><a href="#n204">204</a></p>
<p id="n205" class="pln"><a href="#n205">205</a></p>
<p id="n206" class="pln"><a href="#n206">206</a></p>
<p id="n207" class="pln"><a href="#n207">207</a></p>
<p id="n208" class="pln"><a href="#n208">208</a></p>
<p id="n209" class="pln"><a href="#n209">209</a></p>
<p id="n210" class="pln"><a href="#n210">210</a></p>
<p id="n211" class="pln"><a href="#n211">211</a></p>
<p id="n212" class="pln"><a href="#n212">212</a></p>
<p id="n213" class="pln"><a href="#n213">213</a></p>
<p id="n214" class="pln"><a href="#n214">214</a></p>
<p id="n215" class="pln"><a href="#n215">215</a></p>
<p id="n216" class="pln"><a href="#n216">216</a></p>
<p id="n217" class="pln"><a href="#n217">217</a></p>
<p id="n218" class="pln"><a href="#n218">218</a></p>
<p id="n219" class="pln"><a href="#n219">219</a></p>
<p id="n220" class="pln"><a href="#n220">220</a></p>
<p id="n221" class="stm mis"><a href="#n221">221</a></p>
<p id="n222" class="stm mis"><a href="#n222">222</a></p>
<p id="n223" class="pln"><a href="#n223">223</a></p>
<p id="n224" class="stm run hide_run"><a href="#n224">224</a></p>
<p id="n225" class="pln"><a href="#n225">225</a></p>
<p id="n226" class="pln"><a href="#n226">226</a></p>
<p id="n227" class="pln"><a href="#n227">227</a></p>
<p id="n228" class="pln"><a href="#n228">228</a></p>
<p id="n229" class="pln"><a href="#n229">229</a></p>
<p id="n230" class="stm mis"><a href="#n230">230</a></p>
<p id="n231" class="pln"><a href="#n231">231</a></p>
<p id="n232" class="stm run hide_run"><a href="#n232">232</a></p>
<p id="n233" class="pln"><a href="#n233">233</a></p>
<p id="n234" class="pln"><a href="#n234">234</a></p>
<p id="n235" class="pln"><a href="#n235">235</a></p>
<p id="n236" class="pln"><a href="#n236">236</a></p>
<p id="n237" class="stm mis"><a href="#n237">237</a></p>
<p id="n238" class="pln"><a href="#n238">238</a></p>
<p id="n239" class="stm run hide_run"><a href="#n239">239</a></p>
<p id="n240" class="exc"><a href="#n240">240</a></p>
<p id="n241" class="pln"><a href="#n241">241</a></p>
<p id="n242" class="pln"><a href="#n242">242</a></p>
<p id="n243" class="pln"><a href="#n243">243</a></p>
<p id="n244" class="pln"><a href="#n244">244</a></p>
<p id="n245" class="pln"><a href="#n245">245</a></p>
<p id="n246" class="pln"><a href="#n246">246</a></p>
<p id="n247" class="pln"><a href="#n247">247</a></p>
<p id="n248" class="pln"><a href="#n248">248</a></p>
<p id="n249" class="pln"><a href="#n249">249</a></p>
<p id="n250" class="stm mis"><a href="#n250">250</a></p>
<p id="n251" class="stm mis"><a href="#n251">251</a></p>
<p id="n252" class="stm mis"><a href="#n252">252</a></p>
<p id="n253" class="pln"><a href="#n253">253</a></p>
<p id="n254" class="stm run hide_run"><a href="#n254">254</a></p>
<p id="n255" class="pln"><a href="#n255">255</a></p>
<p id="n256" class="pln"><a href="#n256">256</a></p>
<p id="n257" class="pln"><a href="#n257">257</a></p>
<p id="n258" class="pln"><a href="#n258">258</a></p>
<p id="n259" class="pln"><a href="#n259">259</a></p>
<p id="n260" class="pln"><a href="#n260">260</a></p>
<p id="n261" class="pln"><a href="#n261">261</a></p>
<p id="n262" class="pln"><a href="#n262">262</a></p>
<p id="n263" class="pln"><a href="#n263">263</a></p>
<p id="n264" class="stm mis"><a href="#n264">264</a></p>
<p id="n265" class="pln"><a href="#n265">265</a></p>
<p id="n266" class="stm run hide_run"><a href="#n266">266</a></p>
<p id="n267" class="pln"><a href="#n267">267</a></p>
<p id="n268" class="pln"><a href="#n268">268</a></p>
<p id="n269" class="pln"><a href="#n269">269</a></p>
<p id="n270" class="pln"><a href="#n270">270</a></p>
<p id="n271" class="pln"><a href="#n271">271</a></p>
<p id="n272" class="pln"><a href="#n272">272</a></p>
<p id="n273" class="pln"><a href="#n273">273</a></p>
<p id="n274" class="pln"><a href="#n274">274</a></p>
<p id="n275" class="pln"><a href="#n275">275</a></p>
<p id="n276" class="pln"><a href="#n276">276</a></p>
<p id="n277" class="pln"><a href="#n277">277</a></p>
<p id="n278" class="pln"><a href="#n278">278</a></p>
<p id="n279" class="stm mis"><a href="#n279">279</a></p>
<p id="n280" class="stm mis"><a href="#n280">280</a></p>
<p id="n281" class="stm mis"><a href="#n281">281</a></p>
<p id="n282" class="stm mis"><a href="#n282">282</a></p>
<p id="n283" class="exc"><a href="#n283">283</a></p>
<p id="n284" class="pln"><a href="#n284">284</a></p>
<p id="n285" class="exc"><a href="#n285">285</a></p>
<p id="n286" class="exc"><a href="#n286">286</a></p>
<p id="n287" class="exc"><a href="#n287">287</a></p>
<p id="n288" class="exc"><a href="#n288">288</a></p>
<p id="n289" class="pln"><a href="#n289">289</a></p>
<p id="n290" class="exc"><a href="#n290">290</a></p>
<p id="n291" class="exc"><a href="#n291">291</a></p>
<p id="n292" class="pln"><a href="#n292">292</a></p>
<p id="n293" class="exc"><a href="#n293">293</a></p>
<p id="n294" class="stm mis"><a href="#n294">294</a></p>
<p id="n295" class="pln"><a href="#n295">295</a></p>
<p id="n296" class="pln"><a href="#n296">296</a></p>
<p id="n297" class="stm run hide_run"><a href="#n297">297</a></p>
<p id="n298" class="pln"><a href="#n298">298</a></p>
<p id="n299" class="stm mis"><a href="#n299">299</a></p>
<p id="n300" class="pln"><a href="#n300">300</a></p>
<p id="n301" class="stm run hide_run"><a href="#n301">301</a></p>
<p id="n302" class="stm mis"><a href="#n302">302</a></p>
<p id="n303" class="pln"><a href="#n303">303</a></p>
<p id="n304" class="stm run hide_run"><a href="#n304">304</a></p>
<p id="n305" class="pln"><a href="#n305">305</a></p>
<p id="n306" class="pln"><a href="#n306">306</a></p>
<p id="n307" class="pln"><a href="#n307">307</a></p>
<p id="n308" class="pln"><a href="#n308">308</a></p>
<p id="n309" class="pln"><a href="#n309">309</a></p>
<p id="n310" class="pln"><a href="#n310">310</a></p>
<p id="n311" class="pln"><a href="#n311">311</a></p>
<p id="n312" class="stm mis"><a href="#n312">312</a></p>
<p id="n313" class="stm mis"><a href="#n313">313</a></p>
<p id="n314" class="stm mis"><a href="#n314">314</a></p>
<p id="n315" class="pln"><a href="#n315">315</a></p>
<p id="n316" class="stm run hide_run"><a href="#n316">316</a></p>
<p id="n317" class="pln"><a href="#n317">317</a></p>
<p id="n318" class="stm mis"><a href="#n318">318</a></p>
<p id="n319" class="pln"><a href="#n319">319</a></p>
<p id="n320" class="stm run hide_run"><a href="#n320">320</a></p>
<p id="n321" class="pln"><a href="#n321">321</a></p>
<p id="n322" class="stm mis"><a href="#n322">322</a></p>
<p id="n323" class="pln"><a href="#n323">323</a></p>
<p id="n324" class="stm run hide_run"><a href="#n324">324</a></p>
<p id="n325" class="pln"><a href="#n325">325</a></p>
<p id="n326" class="pln"><a href="#n326">326</a></p>
<p id="n327" class="pln"><a href="#n327">327</a></p>
<p id="n328" class="stm mis"><a href="#n328">328</a></p>
<p id="n329" class="stm mis"><a href="#n329">329</a></p>
<p id="n330" class="stm mis"><a href="#n330">330</a></p>
<p id="n331" class="stm mis"><a href="#n331">331</a></p>
<p id="n332" class="pln"><a href="#n332">332</a></p>
<p id="n333" class="stm run hide_run"><a href="#n333">333</a></p>
<p id="n334" class="pln"><a href="#n334">334</a></p>
<p id="n335" class="pln"><a href="#n335">335</a></p>
<p id="n336" class="pln"><a href="#n336">336</a></p>
<p id="n337" class="pln"><a href="#n337">337</a></p>
<p id="n338" class="pln"><a href="#n338">338</a></p>
<p id="n339" class="pln"><a href="#n339">339</a></p>
<p id="n340" class="pln"><a href="#n340">340</a></p>
<p id="n341" class="pln"><a href="#n341">341</a></p>
<p id="n342" class="stm mis"><a href="#n342">342</a></p>
<p id="n343" class="stm mis"><a href="#n343">343</a></p>
<p id="n344" class="pln"><a href="#n344">344</a></p>
<p id="n345" class="pln"><a href="#n345">345</a></p>
<p id="n346" class="pln"><a href="#n346">346</a></p>
<p id="n347" class="pln"><a href="#n347">347</a></p>
<p id="n348" class="pln"><a href="#n348">348</a></p>
<p id="n349" class="stm mis"><a href="#n349">349</a></p>
<p id="n350" class="pln"><a href="#n350">350</a></p>
<p id="n351" class="stm run hide_run"><a href="#n351">351</a></p>
<p id="n352" class="stm mis"><a href="#n352">352</a></p>
<p id="n353" class="pln"><a href="#n353">353</a></p>
<p id="n354" class="stm run hide_run"><a href="#n354">354</a></p>
<p id="n355" class="stm mis"><a href="#n355">355</a></p>
<p id="n356" class="pln"><a href="#n356">356</a></p>
<p id="n357" class="stm run hide_run"><a href="#n357">357</a></p>
<p id="n358" class="pln"><a href="#n358">358</a></p>
<p id="n359" class="pln"><a href="#n359">359</a></p>
<p id="n360" class="pln"><a href="#n360">360</a></p>
<p id="n361" class="pln"><a href="#n361">361</a></p>
<p id="n362" class="pln"><a href="#n362">362</a></p>
<p id="n363" class="stm run hide_run"><a href="#n363">363</a></p>
<p id="n364" class="pln"><a href="#n364">364</a></p>
<p id="n365" class="pln"><a href="#n365">365</a></p>
<p id="n366" class="pln"><a href="#n366">366</a></p>
<p id="n367" class="pln"><a href="#n367">367</a></p>
<p id="n368" class="pln"><a href="#n368">368</a></p>
<p id="n369" class="pln"><a href="#n369">369</a></p>
<p id="n370" class="pln"><a href="#n370">370</a></p>
<p id="n371" class="pln"><a href="#n371">371</a></p>
<p id="n372" class="pln"><a href="#n372">372</a></p>
<p id="n373" class="stm mis"><a href="#n373">373</a></p>
<p id="n374" class="stm mis"><a href="#n374">374</a></p>
<p id="n375" class="pln"><a href="#n375">375</a></p>
<p id="n376" class="stm mis"><a href="#n376">376</a></p>
<p id="n377" class="pln"><a href="#n377">377</a></p>
<p id="n378" class="stm mis"><a href="#n378">378</a></p>
<p id="n379" class="pln"><a href="#n379">379</a></p>
<p id="n380" class="pln"><a href="#n380">380</a></p>
<p id="n381" class="stm mis"><a href="#n381">381</a></p>
<p id="n382" class="pln"><a href="#n382">382</a></p>
<p id="n383" class="stm mis"><a href="#n383">383</a></p>
<p id="n384" class="stm mis"><a href="#n384">384</a></p>
<p id="n385" class="pln"><a href="#n385">385</a></p>
<p id="n386" class="stm mis"><a href="#n386">386</a></p>
<p id="n387" class="stm mis"><a href="#n387">387</a></p>
<p id="n388" class="stm mis"><a href="#n388">388</a></p>
<p id="n389" class="pln"><a href="#n389">389</a></p>
<p id="n390" class="stm run hide_run"><a href="#n390">390</a></p>
<p id="n391" class="stm mis"><a href="#n391">391</a></p>
<p id="n392" class="stm mis"><a href="#n392">392</a></p>
<p id="n393" class="stm mis"><a href="#n393">393</a></p>
<p id="n394" class="stm mis"><a href="#n394">394</a></p>
<p id="n395" class="stm mis"><a href="#n395">395</a></p>
<p id="n396" class="pln"><a href="#n396">396</a></p>
<p id="n397" class="stm run hide_run"><a href="#n397">397</a></p>
<p id="n398" class="pln"><a href="#n398">398</a></p>
<p id="n399" class="stm mis"><a href="#n399">399</a></p>
<p id="n400" class="stm mis"><a href="#n400">400</a></p>
<p id="n401" class="stm mis"><a href="#n401">401</a></p>
<p id="n402" class="stm mis"><a href="#n402">402</a></p>
<p id="n403" class="stm mis"><a href="#n403">403</a></p>
<p id="n404" class="pln"><a href="#n404">404</a></p>
<p id="n405" class="stm run hide_run"><a href="#n405">405</a></p>
<p id="n406" class="pln"><a href="#n406">406</a></p>
<p id="n407" class="stm mis"><a href="#n407">407</a></p>
<p id="n408" class="pln"><a href="#n408">408</a></p>
<p id="n409" class="stm run hide_run"><a href="#n409">409</a></p>
<p id="n410" class="stm mis"><a href="#n410">410</a></p>
<p id="n411" class="pln"><a href="#n411">411</a></p>
<p id="n412" class="stm run hide_run"><a href="#n412">412</a></p>
<p id="n413" class="pln"><a href="#n413">413</a></p>
<p id="n414" class="pln"><a href="#n414">414</a></p>
<p id="n415" class="pln"><a href="#n415">415</a></p>
<p id="n416" class="pln"><a href="#n416">416</a></p>
<p id="n417" class="pln"><a href="#n417">417</a></p>
<p id="n418" class="stm mis"><a href="#n418">418</a></p>
<p id="n419" class="stm mis"><a href="#n419">419</a></p>
<p id="n420" class="stm mis"><a href="#n420">420</a></p>
<p id="n421" class="stm mis"><a href="#n421">421</a></p>
<p id="n422" class="stm mis"><a href="#n422">422</a></p>
<p id="n423" class="stm mis"><a href="#n423">423</a></p>
<p id="n424" class="stm mis"><a href="#n424">424</a></p>
<p id="n425" class="stm mis"><a href="#n425">425</a></p>
<p id="n426" class="stm mis"><a href="#n426">426</a></p>
<p id="n427" class="stm mis"><a href="#n427">427</a></p>
<p id="n428" class="stm mis"><a href="#n428">428</a></p>
<p id="n429" class="stm mis"><a href="#n429">429</a></p>
<p id="n430" class="pln"><a href="#n430">430</a></p>
<p id="n431" class="exc"><a href="#n431">431</a></p>
<p id="n432" class="pln"><a href="#n432">432</a></p>
<p id="n433" class="stm run hide_run"><a href="#n433">433</a></p>
<p id="n434" class="stm mis"><a href="#n434">434</a></p>
<p id="n435" class="pln"><a href="#n435">435</a></p>
<p id="n436" class="stm run hide_run"><a href="#n436">436</a></p>
<p id="n437" class="pln"><a href="#n437">437</a></p>
<p id="n438" class="stm mis"><a href="#n438">438</a></p>

            </td>
            <td class="text">
<p id="t1" class="pln"><span class="com"># Copyright (c) 2012, GPy authors (see AUTHORS.txt).</span><span class="strut">&nbsp;</span></p>
<p id="t2" class="pln"><span class="com"># Licensed under the BSD 3-clause license (see LICENSE.txt)</span><span class="strut">&nbsp;</span></p>
<p id="t3" class="stm run hide_run"><span class="key">import</span> <span class="nam">sys</span><span class="strut">&nbsp;</span></p>
<p id="t4" class="stm run hide_run"><span class="key">import</span> <span class="nam">numpy</span> <span class="key">as</span> <span class="nam">np</span><span class="strut">&nbsp;</span></p>
<p id="t5" class="stm run hide_run"><span class="key">from</span> <span class="op">...</span><span class="nam">core</span><span class="op">.</span><span class="nam">parameterization</span><span class="op">.</span><span class="nam">parameterized</span> <span class="key">import</span> <span class="nam">Parameterized</span><span class="strut">&nbsp;</span></p>
<p id="t6" class="stm run hide_run"><span class="key">from</span> <span class="nam">paramz</span><span class="op">.</span><span class="nam">caching</span> <span class="key">import</span> <span class="nam">Cache_this</span><span class="strut">&nbsp;</span></p>
<p id="t7" class="stm run hide_run"><span class="key">from</span> <span class="op">.</span><span class="nam">kernel_slice_operations</span> <span class="key">import</span> <span class="nam">KernCallsViaSlicerMeta</span><span class="strut">&nbsp;</span></p>
<p id="t8" class="stm run hide_run"><span class="key">from</span> <span class="nam">functools</span> <span class="key">import</span> <span class="nam">reduce</span><span class="strut">&nbsp;</span></p>
<p id="t9" class="stm run hide_run"><span class="key">import</span> <span class="nam">six</span><span class="strut">&nbsp;</span></p>
<p id="t10" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t11" class="stm run hide_run"><span class="op">@</span><span class="nam">six</span><span class="op">.</span><span class="nam">add_metaclass</span><span class="op">(</span><span class="nam">KernCallsViaSlicerMeta</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t12" class="stm run hide_run"><span class="key">class</span> <span class="nam">Kern</span><span class="op">(</span><span class="nam">Parameterized</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t13" class="pln">    <span class="com">#===========================================================================</span><span class="strut">&nbsp;</span></p>
<p id="t14" class="pln">    <span class="com"># This adds input slice support. The rather ugly code for slicing can be</span><span class="strut">&nbsp;</span></p>
<p id="t15" class="pln">    <span class="com"># found in kernel_slice_operations</span><span class="strut">&nbsp;</span></p>
<p id="t16" class="pln">    <span class="com"># __meataclass__ is ignored in Python 3 - needs to be put in the function definiton</span><span class="strut">&nbsp;</span></p>
<p id="t17" class="pln">    <span class="com"># __metaclass__ = KernCallsViaSlicerMeta</span><span class="strut">&nbsp;</span></p>
<p id="t18" class="pln">    <span class="com"># Here, we use the Python module six to support Py3 and Py2 simultaneously</span><span class="strut">&nbsp;</span></p>
<p id="t19" class="pln">    <span class="com">#===========================================================================</span><span class="strut">&nbsp;</span></p>
<p id="t20" class="stm run hide_run">    <span class="nam">_support_GPU</span> <span class="op">=</span> <span class="key">False</span><span class="strut">&nbsp;</span></p>
<p id="t21" class="stm run hide_run">    <span class="key">def</span> <span class="nam">__init__</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">input_dim</span><span class="op">,</span> <span class="nam">active_dims</span><span class="op">,</span> <span class="nam">name</span><span class="op">,</span> <span class="nam">useGPU</span><span class="op">=</span><span class="key">False</span><span class="op">,</span> <span class="op">*</span><span class="nam">a</span><span class="op">,</span> <span class="op">**</span><span class="nam">kw</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t22" class="exc">        <span class="str">"""</span><span class="strut">&nbsp;</span></p>
<p id="t23" class="pln"><span class="str">        The base class for a kernel: a positive definite function</span><span class="strut">&nbsp;</span></p>
<p id="t24" class="pln"><span class="str">        which forms of a covariance function (kernel).</span><span class="strut">&nbsp;</span></p>
<p id="t25" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t26" class="pln"><span class="str">        input_dim:</span><span class="strut">&nbsp;</span></p>
<p id="t27" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t28" class="pln"><span class="str">            is the number of dimensions to work on. Make sure to give the</span><span class="strut">&nbsp;</span></p>
<p id="t29" class="pln"><span class="str">            tight dimensionality of inputs.</span><span class="strut">&nbsp;</span></p>
<p id="t30" class="pln"><span class="str">            You most likely want this to be the integer telling the number of</span><span class="strut">&nbsp;</span></p>
<p id="t31" class="pln"><span class="str">            input dimensions of the kernel.</span><span class="strut">&nbsp;</span></p>
<p id="t32" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t33" class="pln"><span class="str">        active_dims:</span><span class="strut">&nbsp;</span></p>
<p id="t34" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t35" class="pln"><span class="str">            is the active_dimensions of inputs X we will work on.</span><span class="strut">&nbsp;</span></p>
<p id="t36" class="pln"><span class="str">            All kernels will get sliced Xes as inputs, if _all_dims_active is not None</span><span class="strut">&nbsp;</span></p>
<p id="t37" class="pln"><span class="str">            Only positive integers are allowed in active_dims!</span><span class="strut">&nbsp;</span></p>
<p id="t38" class="pln"><span class="str">            if active_dims is None, slicing is switched off and all X will be passed through as given.</span><span class="strut">&nbsp;</span></p>
<p id="t39" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t40" class="pln"><span class="str">        :param int input_dim: the number of input dimensions to the function</span><span class="strut">&nbsp;</span></p>
<p id="t41" class="pln"><span class="str">        :param array-like|None active_dims: list of indices on which dimensions this kernel works on, or none if no slicing</span><span class="strut">&nbsp;</span></p>
<p id="t42" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t43" class="pln"><span class="str">        Do not instantiate.</span><span class="strut">&nbsp;</span></p>
<p id="t44" class="pln"><span class="str">        """</span><span class="strut">&nbsp;</span></p>
<p id="t45" class="stm mis">        <span class="nam">super</span><span class="op">(</span><span class="nam">Kern</span><span class="op">,</span> <span class="nam">self</span><span class="op">)</span><span class="op">.</span><span class="nam">__init__</span><span class="op">(</span><span class="nam">name</span><span class="op">=</span><span class="nam">name</span><span class="op">,</span> <span class="op">*</span><span class="nam">a</span><span class="op">,</span> <span class="op">**</span><span class="nam">kw</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t46" class="stm mis">        <span class="nam">self</span><span class="op">.</span><span class="nam">input_dim</span> <span class="op">=</span> <span class="nam">int</span><span class="op">(</span><span class="nam">input_dim</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t47" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t48" class="stm mis">        <span class="key">if</span> <span class="nam">active_dims</span> <span class="key">is</span> <span class="key">None</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t49" class="stm mis">            <span class="nam">active_dims</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">arange</span><span class="op">(</span><span class="nam">input_dim</span><span class="op">,</span> <span class="nam">dtype</span><span class="op">=</span><span class="nam">np</span><span class="op">.</span><span class="nam">int_</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t50" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t51" class="stm mis">        <span class="nam">self</span><span class="op">.</span><span class="nam">active_dims</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">atleast_1d</span><span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">asarray</span><span class="op">(</span><span class="nam">active_dims</span><span class="op">,</span> <span class="nam">np</span><span class="op">.</span><span class="nam">int_</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t52" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t53" class="stm mis">        <span class="nam">self</span><span class="op">.</span><span class="nam">_all_dims_active</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">atleast_1d</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">active_dims</span><span class="op">)</span><span class="op">.</span><span class="nam">astype</span><span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">int_</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t54" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t55" class="stm mis">        <span class="key">assert</span> <span class="nam">self</span><span class="op">.</span><span class="nam">active_dims</span><span class="op">.</span><span class="nam">size</span> <span class="op">==</span> <span class="nam">self</span><span class="op">.</span><span class="nam">input_dim</span><span class="op">,</span> <span class="str">"input_dim={} does not match len(active_dim)={}"</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">input_dim</span><span class="op">,</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_all_dims_active</span><span class="op">.</span><span class="nam">size</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t56" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t57" class="stm mis">        <span class="nam">self</span><span class="op">.</span><span class="nam">_sliced_X</span> <span class="op">=</span> <span class="num">0</span><span class="strut">&nbsp;</span></p>
<p id="t58" class="stm mis">        <span class="nam">self</span><span class="op">.</span><span class="nam">useGPU</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_support_GPU</span> <span class="key">and</span> <span class="nam">useGPU</span><span class="strut">&nbsp;</span></p>
<p id="t59" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t60" class="stm mis">        <span class="key">from</span> <span class="op">.</span><span class="nam">psi_comp</span> <span class="key">import</span> <span class="nam">PSICOMP_GH</span><span class="strut">&nbsp;</span></p>
<p id="t61" class="stm mis">        <span class="nam">self</span><span class="op">.</span><span class="nam">psicomp</span> <span class="op">=</span> <span class="nam">PSICOMP_GH</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t62" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t63" class="stm run hide_run">    <span class="key">def</span> <span class="nam">_save_to_input_dict</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t64" class="stm mis">        <span class="nam">input_dict</span> <span class="op">=</span> <span class="op">{</span><span class="op">}</span><span class="strut">&nbsp;</span></p>
<p id="t65" class="stm mis">        <span class="nam">input_dict</span><span class="op">[</span><span class="str">"input_dim"</span><span class="op">]</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">input_dim</span><span class="strut">&nbsp;</span></p>
<p id="t66" class="stm mis">        <span class="key">if</span> <span class="nam">isinstance</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">active_dims</span><span class="op">,</span> <span class="nam">np</span><span class="op">.</span><span class="nam">ndarray</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t67" class="stm mis">            <span class="nam">input_dict</span><span class="op">[</span><span class="str">"active_dims"</span><span class="op">]</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">active_dims</span><span class="op">.</span><span class="nam">tolist</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t68" class="pln">        <span class="key">else</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t69" class="stm mis">            <span class="nam">input_dict</span><span class="op">[</span><span class="str">"active_dims"</span><span class="op">]</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">active_dims</span><span class="strut">&nbsp;</span></p>
<p id="t70" class="stm mis">        <span class="nam">input_dict</span><span class="op">[</span><span class="str">"name"</span><span class="op">]</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">name</span><span class="strut">&nbsp;</span></p>
<p id="t71" class="stm mis">        <span class="nam">input_dict</span><span class="op">[</span><span class="str">"useGPU"</span><span class="op">]</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">useGPU</span><span class="strut">&nbsp;</span></p>
<p id="t72" class="stm mis">        <span class="key">return</span> <span class="nam">input_dict</span><span class="strut">&nbsp;</span></p>
<p id="t73" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t74" class="stm run hide_run">    <span class="key">def</span> <span class="nam">to_dict</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t75" class="exc">        <span class="key">raise</span> <span class="nam">NotImplementedError</span><span class="strut">&nbsp;</span></p>
<p id="t76" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t77" class="stm run hide_run">    <span class="op">@</span><span class="nam">staticmethod</span><span class="strut">&nbsp;</span></p>
<p id="t78" class="pln">    <span class="key">def</span> <span class="nam">from_dict</span><span class="op">(</span><span class="nam">input_dict</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t79" class="pln">        <span class="str">"""</span><span class="strut">&nbsp;</span></p>
<p id="t80" class="pln"><span class="str">        Instantiate an object of a derived class using the information</span><span class="strut">&nbsp;</span></p>
<p id="t81" class="pln"><span class="str">        in input_dict (built by the to_dict method of the derived class).</span><span class="strut">&nbsp;</span></p>
<p id="t82" class="pln"><span class="str">        More specifically, after reading the derived class from input_dict,</span><span class="strut">&nbsp;</span></p>
<p id="t83" class="pln"><span class="str">        it calls the method _build_from_input_dict of the derived class.</span><span class="strut">&nbsp;</span></p>
<p id="t84" class="pln"><span class="str">        Note: This method should not be overrided in the derived class. In case</span><span class="strut">&nbsp;</span></p>
<p id="t85" class="pln"><span class="str">        it is needed, please override _build_from_input_dict instate.</span><span class="strut">&nbsp;</span></p>
<p id="t86" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t87" class="pln"><span class="str">        :param dict input_dict: Dictionary with all the information needed to</span><span class="strut">&nbsp;</span></p>
<p id="t88" class="pln"><span class="str">           instantiate the object.</span><span class="strut">&nbsp;</span></p>
<p id="t89" class="pln"><span class="str">        """</span><span class="strut">&nbsp;</span></p>
<p id="t90" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t91" class="stm mis">        <span class="key">import</span> <span class="nam">copy</span><span class="strut">&nbsp;</span></p>
<p id="t92" class="stm mis">        <span class="nam">input_dict</span> <span class="op">=</span> <span class="nam">copy</span><span class="op">.</span><span class="nam">deepcopy</span><span class="op">(</span><span class="nam">input_dict</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t93" class="stm mis">        <span class="nam">kernel_class</span> <span class="op">=</span> <span class="nam">input_dict</span><span class="op">.</span><span class="nam">pop</span><span class="op">(</span><span class="str">'class'</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t94" class="stm mis">        <span class="nam">input_dict</span><span class="op">[</span><span class="str">"name"</span><span class="op">]</span> <span class="op">=</span> <span class="nam">str</span><span class="op">(</span><span class="nam">input_dict</span><span class="op">[</span><span class="str">"name"</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t95" class="stm mis">        <span class="key">import</span> <span class="nam">GPy</span><span class="strut">&nbsp;</span></p>
<p id="t96" class="stm mis">        <span class="nam">kernel_class</span> <span class="op">=</span> <span class="nam">eval</span><span class="op">(</span><span class="nam">kernel_class</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t97" class="stm mis">        <span class="key">return</span> <span class="nam">kernel_class</span><span class="op">.</span><span class="nam">_build_from_input_dict</span><span class="op">(</span><span class="nam">kernel_class</span><span class="op">,</span> <span class="nam">input_dict</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t98" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t99" class="stm run hide_run">    <span class="op">@</span><span class="nam">staticmethod</span><span class="strut">&nbsp;</span></p>
<p id="t100" class="pln">    <span class="key">def</span> <span class="nam">_build_from_input_dict</span><span class="op">(</span><span class="nam">kernel_class</span><span class="op">,</span> <span class="nam">input_dict</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t101" class="stm mis">        <span class="key">return</span> <span class="nam">kernel_class</span><span class="op">(</span><span class="op">**</span><span class="nam">input_dict</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t102" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t103" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t104" class="stm run hide_run">    <span class="key">def</span> <span class="nam">__setstate__</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">state</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t105" class="stm mis">        <span class="nam">self</span><span class="op">.</span><span class="nam">_all_dims_active</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">arange</span><span class="op">(</span><span class="num">0</span><span class="op">,</span> <span class="nam">max</span><span class="op">(</span><span class="nam">state</span><span class="op">[</span><span class="str">'active_dims'</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="num">1</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t106" class="stm mis">        <span class="nam">super</span><span class="op">(</span><span class="nam">Kern</span><span class="op">,</span> <span class="nam">self</span><span class="op">)</span><span class="op">.</span><span class="nam">__setstate__</span><span class="op">(</span><span class="nam">state</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t107" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t108" class="stm run hide_run">    <span class="op">@</span><span class="nam">property</span><span class="strut">&nbsp;</span></p>
<p id="t109" class="pln">    <span class="key">def</span> <span class="nam">_effective_input_dim</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t110" class="stm mis">        <span class="key">return</span> <span class="nam">np</span><span class="op">.</span><span class="nam">size</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">_all_dims_active</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t111" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t112" class="stm run hide_run">    <span class="op">@</span><span class="nam">Cache_this</span><span class="op">(</span><span class="nam">limit</span><span class="op">=</span><span class="num">3</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t113" class="pln">    <span class="key">def</span> <span class="nam">_slice_X</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">X</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t114" class="stm mis">        <span class="key">try</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t115" class="stm mis">            <span class="key">return</span> <span class="nam">X</span><span class="op">[</span><span class="op">:</span><span class="op">,</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_all_dims_active</span><span class="op">]</span><span class="op">.</span><span class="nam">astype</span><span class="op">(</span><span class="str">'float'</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t116" class="exc">        <span class="key">except</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t117" class="exc">            <span class="key">return</span> <span class="nam">X</span><span class="op">[</span><span class="op">:</span><span class="op">,</span> <span class="nam">self</span><span class="op">.</span><span class="nam">_all_dims_active</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t118" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t119" class="stm run hide_run">    <span class="key">def</span> <span class="nam">K</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">X</span><span class="op">,</span> <span class="nam">X2</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t120" class="exc">        <span class="str">"""</span><span class="strut">&nbsp;</span></p>
<p id="t121" class="pln"><span class="str">        Compute the kernel function.</span><span class="strut">&nbsp;</span></p>
<p id="t122" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t123" class="pln"><span class="str">        .. math::</span><span class="strut">&nbsp;</span></p>
<p id="t124" class="pln"><span class="str">            K_{ij} = k(X_i, X_j)</span><span class="strut">&nbsp;</span></p>
<p id="t125" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t126" class="pln"><span class="str">        :param X: the first set of inputs to the kernel</span><span class="strut">&nbsp;</span></p>
<p id="t127" class="pln"><span class="str">        :param X2: (optional) the second set of arguments to the kernel. If X2</span><span class="strut">&nbsp;</span></p>
<p id="t128" class="pln"><span class="str">                   is None, this is passed throgh to the 'part' object, which</span><span class="strut">&nbsp;</span></p>
<p id="t129" class="pln"><span class="str">                   handLes this as X2 == X.</span><span class="strut">&nbsp;</span></p>
<p id="t130" class="pln"><span class="str">        """</span><span class="strut">&nbsp;</span></p>
<p id="t131" class="exc">        <span class="key">raise</span> <span class="nam">NotImplementedError</span><span class="strut">&nbsp;</span></p>
<p id="t132" class="stm run hide_run">    <span class="key">def</span> <span class="nam">Kdiag</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">X</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t133" class="pln">        <span class="str">"""</span><span class="strut">&nbsp;</span></p>
<p id="t134" class="pln"><span class="str">        The diagonal of the kernel matrix K</span><span class="strut">&nbsp;</span></p>
<p id="t135" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t136" class="pln"><span class="str">        .. math::</span><span class="strut">&nbsp;</span></p>
<p id="t137" class="pln"><span class="str">            Kdiag_{i} = k(X_i, X_i)</span><span class="strut">&nbsp;</span></p>
<p id="t138" class="pln"><span class="str">        """</span><span class="strut">&nbsp;</span></p>
<p id="t139" class="exc">        <span class="key">raise</span> <span class="nam">NotImplementedError</span><span class="strut">&nbsp;</span></p>
<p id="t140" class="stm run hide_run">    <span class="key">def</span> <span class="nam">psi0</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">Z</span><span class="op">,</span> <span class="nam">variational_posterior</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t141" class="pln">        <span class="str">"""</span><span class="strut">&nbsp;</span></p>
<p id="t142" class="pln"><span class="str">        .. math::</span><span class="strut">&nbsp;</span></p>
<p id="t143" class="pln"><span class="str">            \psi_0 = \sum_{i=0}^{n}E_{q(X)}[k(X_i, X_i)]</span><span class="strut">&nbsp;</span></p>
<p id="t144" class="pln"><span class="str">        """</span><span class="strut">&nbsp;</span></p>
<p id="t145" class="stm mis">        <span class="key">return</span> <span class="nam">self</span><span class="op">.</span><span class="nam">psicomp</span><span class="op">.</span><span class="nam">psicomputations</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">Z</span><span class="op">,</span> <span class="nam">variational_posterior</span><span class="op">)</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t146" class="stm run hide_run">    <span class="key">def</span> <span class="nam">psi1</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">Z</span><span class="op">,</span> <span class="nam">variational_posterior</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t147" class="pln">        <span class="str">"""</span><span class="strut">&nbsp;</span></p>
<p id="t148" class="pln"><span class="str">        .. math::</span><span class="strut">&nbsp;</span></p>
<p id="t149" class="pln"><span class="str">            \psi_1^{n,m} = E_{q(X)}[k(X_n, Z_m)]</span><span class="strut">&nbsp;</span></p>
<p id="t150" class="pln"><span class="str">        """</span><span class="strut">&nbsp;</span></p>
<p id="t151" class="stm mis">        <span class="key">return</span> <span class="nam">self</span><span class="op">.</span><span class="nam">psicomp</span><span class="op">.</span><span class="nam">psicomputations</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">Z</span><span class="op">,</span> <span class="nam">variational_posterior</span><span class="op">)</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t152" class="stm run hide_run">    <span class="key">def</span> <span class="nam">psi2</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">Z</span><span class="op">,</span> <span class="nam">variational_posterior</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t153" class="pln">        <span class="str">"""</span><span class="strut">&nbsp;</span></p>
<p id="t154" class="pln"><span class="str">        .. math::</span><span class="strut">&nbsp;</span></p>
<p id="t155" class="pln"><span class="str">            \psi_2^{m,m'} = \sum_{i=0}^{n}E_{q(X)}[ k(Z_m, X_i) k(X_i, Z_{m'})]</span><span class="strut">&nbsp;</span></p>
<p id="t156" class="pln"><span class="str">        """</span><span class="strut">&nbsp;</span></p>
<p id="t157" class="stm mis">        <span class="key">return</span> <span class="nam">self</span><span class="op">.</span><span class="nam">psicomp</span><span class="op">.</span><span class="nam">psicomputations</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">Z</span><span class="op">,</span> <span class="nam">variational_posterior</span><span class="op">,</span> <span class="nam">return_psi2_n</span><span class="op">=</span><span class="key">False</span><span class="op">)</span><span class="op">[</span><span class="num">2</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t158" class="stm run hide_run">    <span class="key">def</span> <span class="nam">psi2n</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">Z</span><span class="op">,</span> <span class="nam">variational_posterior</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t159" class="pln">        <span class="str">"""</span><span class="strut">&nbsp;</span></p>
<p id="t160" class="pln"><span class="str">        .. math::</span><span class="strut">&nbsp;</span></p>
<p id="t161" class="pln"><span class="str">            \psi_2^{n,m,m'} = E_{q(X)}[ k(Z_m, X_n) k(X_n, Z_{m'})]</span><span class="strut">&nbsp;</span></p>
<p id="t162" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t163" class="pln"><span class="str">        Thus, we do not sum out n, compared to psi2</span><span class="strut">&nbsp;</span></p>
<p id="t164" class="pln"><span class="str">        """</span><span class="strut">&nbsp;</span></p>
<p id="t165" class="stm mis">        <span class="key">return</span> <span class="nam">self</span><span class="op">.</span><span class="nam">psicomp</span><span class="op">.</span><span class="nam">psicomputations</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">Z</span><span class="op">,</span> <span class="nam">variational_posterior</span><span class="op">,</span> <span class="nam">return_psi2_n</span><span class="op">=</span><span class="key">True</span><span class="op">)</span><span class="op">[</span><span class="num">2</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t166" class="stm run hide_run">    <span class="key">def</span> <span class="nam">gradients_X</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">dL_dK</span><span class="op">,</span> <span class="nam">X</span><span class="op">,</span> <span class="nam">X2</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t167" class="pln">        <span class="str">"""</span><span class="strut">&nbsp;</span></p>
<p id="t168" class="pln"><span class="str">        .. math::</span><span class="strut">&nbsp;</span></p>
<p id="t169" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t170" class="pln"><span class="str">            \\frac{\partial L}{\partial X} = \\frac{\partial L}{\partial K}\\frac{\partial K}{\partial X}</span><span class="strut">&nbsp;</span></p>
<p id="t171" class="pln"><span class="str">        """</span><span class="strut">&nbsp;</span></p>
<p id="t172" class="exc">        <span class="key">raise</span> <span class="nam">NotImplementedError</span><span class="strut">&nbsp;</span></p>
<p id="t173" class="stm run hide_run">    <span class="key">def</span> <span class="nam">gradients_X_X2</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">dL_dK</span><span class="op">,</span> <span class="nam">X</span><span class="op">,</span> <span class="nam">X2</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t174" class="stm mis">        <span class="key">return</span> <span class="nam">self</span><span class="op">.</span><span class="nam">gradients_X</span><span class="op">(</span><span class="nam">dL_dK</span><span class="op">,</span> <span class="nam">X</span><span class="op">,</span> <span class="nam">X2</span><span class="op">)</span><span class="op">,</span> <span class="nam">self</span><span class="op">.</span><span class="nam">gradients_X</span><span class="op">(</span><span class="nam">dL_dK</span><span class="op">.</span><span class="nam">T</span><span class="op">,</span> <span class="nam">X2</span><span class="op">,</span> <span class="nam">X</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t175" class="stm run hide_run">    <span class="key">def</span> <span class="nam">gradients_XX</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">dL_dK</span><span class="op">,</span> <span class="nam">X</span><span class="op">,</span> <span class="nam">X2</span><span class="op">,</span> <span class="nam">cov</span><span class="op">=</span><span class="key">True</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t176" class="pln">        <span class="str">"""</span><span class="strut">&nbsp;</span></p>
<p id="t177" class="pln"><span class="str">        .. math::</span><span class="strut">&nbsp;</span></p>
<p id="t178" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t179" class="pln"><span class="str">            \\frac{\partial^2 L}{\partial X\partial X_2} = \\frac{\partial L}{\partial K}\\frac{\partial^2 K}{\partial X\partial X_2}</span><span class="strut">&nbsp;</span></p>
<p id="t180" class="pln"><span class="str">        """</span><span class="strut">&nbsp;</span></p>
<p id="t181" class="exc">        <span class="key">raise</span> <span class="nam">NotImplementedError</span><span class="op">(</span><span class="str">"This is the second derivative of K wrt X and X2, and not implemented for this kernel"</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t182" class="stm run hide_run">    <span class="key">def</span> <span class="nam">gradients_XX_diag</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">dL_dKdiag</span><span class="op">,</span> <span class="nam">X</span><span class="op">,</span> <span class="nam">cov</span><span class="op">=</span><span class="key">True</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t183" class="pln">        <span class="str">"""</span><span class="strut">&nbsp;</span></p>
<p id="t184" class="pln"><span class="str">        The diagonal of the second derivative w.r.t. X and X2</span><span class="strut">&nbsp;</span></p>
<p id="t185" class="pln"><span class="str">        """</span><span class="strut">&nbsp;</span></p>
<p id="t186" class="exc">        <span class="key">raise</span> <span class="nam">NotImplementedError</span><span class="op">(</span><span class="str">"This is the diagonal of the second derivative of K wrt X and X2, and not implemented for this kernel"</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t187" class="stm run hide_run">    <span class="key">def</span> <span class="nam">gradients_X_diag</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">dL_dKdiag</span><span class="op">,</span> <span class="nam">X</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t188" class="pln">        <span class="str">"""</span><span class="strut">&nbsp;</span></p>
<p id="t189" class="pln"><span class="str">        The diagonal of the derivative w.r.t. X</span><span class="strut">&nbsp;</span></p>
<p id="t190" class="pln"><span class="str">        """</span><span class="strut">&nbsp;</span></p>
<p id="t191" class="exc">        <span class="key">raise</span> <span class="nam">NotImplementedError</span><span class="strut">&nbsp;</span></p>
<p id="t192" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t193" class="stm run hide_run">    <span class="key">def</span> <span class="nam">update_gradients_diag</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">dL_dKdiag</span><span class="op">,</span> <span class="nam">X</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t194" class="pln">        <span class="str">""" update the gradients of all parameters when using only the diagonal elements of the covariance matrix"""</span><span class="strut">&nbsp;</span></p>
<p id="t195" class="exc">        <span class="key">raise</span> <span class="nam">NotImplementedError</span><span class="strut">&nbsp;</span></p>
<p id="t196" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t197" class="stm run hide_run">    <span class="key">def</span> <span class="nam">update_gradients_full</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">dL_dK</span><span class="op">,</span> <span class="nam">X</span><span class="op">,</span> <span class="nam">X2</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t198" class="pln">        <span class="str">"""Set the gradients of all parameters when doing full (N) inference."""</span><span class="strut">&nbsp;</span></p>
<p id="t199" class="exc">        <span class="key">raise</span> <span class="nam">NotImplementedError</span><span class="strut">&nbsp;</span></p>
<p id="t200" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t201" class="stm run hide_run">    <span class="key">def</span> <span class="nam">reset_gradients</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t202" class="exc">        <span class="key">raise</span> <span class="nam">NotImplementedError</span><span class="strut">&nbsp;</span></p>
<p id="t203" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t204" class="stm run hide_run">    <span class="key">def</span> <span class="nam">update_gradients_expectations</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">dL_dpsi0</span><span class="op">,</span> <span class="nam">dL_dpsi1</span><span class="op">,</span> <span class="nam">dL_dpsi2</span><span class="op">,</span> <span class="nam">Z</span><span class="op">,</span> <span class="nam">variational_posterior</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t205" class="pln">        <span class="str">"""</span><span class="strut">&nbsp;</span></p>
<p id="t206" class="pln"><span class="str">        Set the gradients of all parameters when doing inference with</span><span class="strut">&nbsp;</span></p>
<p id="t207" class="pln"><span class="str">        uncertain inputs, using expectations of the kernel.</span><span class="strut">&nbsp;</span></p>
<p id="t208" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t209" class="pln"><span class="str">        The essential maths is</span><span class="strut">&nbsp;</span></p>
<p id="t210" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t211" class="pln"><span class="str">        .. math::</span><span class="strut">&nbsp;</span></p>
<p id="t212" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t213" class="pln"><span class="str">            \\frac{\partial L}{\partial \\theta_i} &amp; = \\frac{\partial L}{\partial \psi_0}\\frac{\partial \psi_0}{\partial \\theta_i}\\</span><span class="strut">&nbsp;</span></p>
<p id="t214" class="pln"><span class="str">                &amp; \quad + \\frac{\partial L}{\partial \psi_1}\\frac{\partial \psi_1}{\partial \\theta_i}\\</span><span class="strut">&nbsp;</span></p>
<p id="t215" class="pln"><span class="str">                &amp; \quad + \\frac{\partial L}{\partial \psi_2}\\frac{\partial \psi_2}{\partial \\theta_i}</span><span class="strut">&nbsp;</span></p>
<p id="t216" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t217" class="pln"><span class="str">        Thus, we push the different derivatives through the gradients of the psi</span><span class="strut">&nbsp;</span></p>
<p id="t218" class="pln"><span class="str">        statistics. Be sure to set the gradients for all kernel</span><span class="strut">&nbsp;</span></p>
<p id="t219" class="pln"><span class="str">        parameters here.</span><span class="strut">&nbsp;</span></p>
<p id="t220" class="pln"><span class="str">        """</span><span class="strut">&nbsp;</span></p>
<p id="t221" class="stm mis">        <span class="nam">dtheta</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">psicomp</span><span class="op">.</span><span class="nam">psiDerivativecomputations</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">dL_dpsi0</span><span class="op">,</span> <span class="nam">dL_dpsi1</span><span class="op">,</span> <span class="nam">dL_dpsi2</span><span class="op">,</span> <span class="nam">Z</span><span class="op">,</span> <span class="nam">variational_posterior</span><span class="op">)</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t222" class="stm mis">        <span class="nam">self</span><span class="op">.</span><span class="nam">gradient</span><span class="op">[</span><span class="op">:</span><span class="op">]</span> <span class="op">=</span> <span class="nam">dtheta</span><span class="strut">&nbsp;</span></p>
<p id="t223" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t224" class="stm run hide_run">    <span class="key">def</span> <span class="nam">gradients_Z_expectations</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">dL_dpsi0</span><span class="op">,</span> <span class="nam">dL_dpsi1</span><span class="op">,</span> <span class="nam">dL_dpsi2</span><span class="op">,</span> <span class="nam">Z</span><span class="op">,</span> <span class="nam">variational_posterior</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t225" class="pln">                                <span class="nam">psi0</span><span class="op">=</span><span class="key">None</span><span class="op">,</span> <span class="nam">psi1</span><span class="op">=</span><span class="key">None</span><span class="op">,</span> <span class="nam">psi2</span><span class="op">=</span><span class="key">None</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t226" class="pln">        <span class="str">"""</span><span class="strut">&nbsp;</span></p>
<p id="t227" class="pln"><span class="str">        Returns the derivative of the objective wrt Z, using the chain rule</span><span class="strut">&nbsp;</span></p>
<p id="t228" class="pln"><span class="str">        through the expectation variables.</span><span class="strut">&nbsp;</span></p>
<p id="t229" class="pln"><span class="str">        """</span><span class="strut">&nbsp;</span></p>
<p id="t230" class="stm mis">        <span class="key">return</span> <span class="nam">self</span><span class="op">.</span><span class="nam">psicomp</span><span class="op">.</span><span class="nam">psiDerivativecomputations</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">dL_dpsi0</span><span class="op">,</span> <span class="nam">dL_dpsi1</span><span class="op">,</span> <span class="nam">dL_dpsi2</span><span class="op">,</span> <span class="nam">Z</span><span class="op">,</span> <span class="nam">variational_posterior</span><span class="op">)</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t231" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t232" class="stm run hide_run">    <span class="key">def</span> <span class="nam">gradients_qX_expectations</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">dL_dpsi0</span><span class="op">,</span> <span class="nam">dL_dpsi1</span><span class="op">,</span> <span class="nam">dL_dpsi2</span><span class="op">,</span> <span class="nam">Z</span><span class="op">,</span> <span class="nam">variational_posterior</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t233" class="pln">        <span class="str">"""</span><span class="strut">&nbsp;</span></p>
<p id="t234" class="pln"><span class="str">        Compute the gradients wrt the parameters of the variational</span><span class="strut">&nbsp;</span></p>
<p id="t235" class="pln"><span class="str">        distruibution q(X), chain-ruling via the expectations of the kernel</span><span class="strut">&nbsp;</span></p>
<p id="t236" class="pln"><span class="str">        """</span><span class="strut">&nbsp;</span></p>
<p id="t237" class="stm mis">        <span class="key">return</span> <span class="nam">self</span><span class="op">.</span><span class="nam">psicomp</span><span class="op">.</span><span class="nam">psiDerivativecomputations</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">dL_dpsi0</span><span class="op">,</span> <span class="nam">dL_dpsi1</span><span class="op">,</span> <span class="nam">dL_dpsi2</span><span class="op">,</span> <span class="nam">Z</span><span class="op">,</span> <span class="nam">variational_posterior</span><span class="op">)</span><span class="op">[</span><span class="num">2</span><span class="op">:</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t238" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t239" class="stm run hide_run">    <span class="key">def</span> <span class="nam">plot</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">x</span><span class="op">=</span><span class="key">None</span><span class="op">,</span> <span class="nam">fignum</span><span class="op">=</span><span class="key">None</span><span class="op">,</span> <span class="nam">ax</span><span class="op">=</span><span class="key">None</span><span class="op">,</span> <span class="nam">title</span><span class="op">=</span><span class="key">None</span><span class="op">,</span> <span class="nam">plot_limits</span><span class="op">=</span><span class="key">None</span><span class="op">,</span> <span class="nam">resolution</span><span class="op">=</span><span class="key">None</span><span class="op">,</span> <span class="op">**</span><span class="nam">mpl_kwargs</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t240" class="exc">        <span class="str">"""</span><span class="strut">&nbsp;</span></p>
<p id="t241" class="pln"><span class="str">        plot this kernel.</span><span class="strut">&nbsp;</span></p>
<p id="t242" class="pln"><span class="str">        :param x: the value to use for the other kernel argument (kernels are a function of two variables!)</span><span class="strut">&nbsp;</span></p>
<p id="t243" class="pln"><span class="str">        :param fignum: figure number of the plot</span><span class="strut">&nbsp;</span></p>
<p id="t244" class="pln"><span class="str">        :param ax: matplotlib axis to plot on</span><span class="strut">&nbsp;</span></p>
<p id="t245" class="pln"><span class="str">        :param title: the matplotlib title</span><span class="strut">&nbsp;</span></p>
<p id="t246" class="pln"><span class="str">        :param plot_limits: the range over which to plot the kernel</span><span class="strut">&nbsp;</span></p>
<p id="t247" class="pln"><span class="str">        :resolution: the resolution of the lines used in plotting</span><span class="strut">&nbsp;</span></p>
<p id="t248" class="pln"><span class="str">        :mpl_kwargs avalid keyword arguments to pass through to matplotlib (e.g. lw=7)</span><span class="strut">&nbsp;</span></p>
<p id="t249" class="pln"><span class="str">        """</span><span class="strut">&nbsp;</span></p>
<p id="t250" class="stm mis">        <span class="key">assert</span> <span class="str">"matplotlib"</span> <span class="key">in</span> <span class="nam">sys</span><span class="op">.</span><span class="nam">modules</span><span class="op">,</span> <span class="str">"matplotlib package has not been imported."</span><span class="strut">&nbsp;</span></p>
<p id="t251" class="stm mis">        <span class="key">from</span> <span class="op">...</span><span class="nam">plotting</span><span class="op">.</span><span class="nam">matplot_dep</span> <span class="key">import</span> <span class="nam">kernel_plots</span><span class="strut">&nbsp;</span></p>
<p id="t252" class="stm mis">        <span class="nam">kernel_plots</span><span class="op">.</span><span class="nam">plot</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">x</span><span class="op">,</span> <span class="nam">fignum</span><span class="op">,</span> <span class="nam">ax</span><span class="op">,</span> <span class="nam">title</span><span class="op">,</span> <span class="nam">plot_limits</span><span class="op">,</span> <span class="nam">resolution</span><span class="op">,</span> <span class="op">**</span><span class="nam">mpl_kwargs</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t253" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t254" class="stm run hide_run">    <span class="key">def</span> <span class="nam">input_sensitivity</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">summarize</span><span class="op">=</span><span class="key">True</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t255" class="pln">        <span class="str">"""</span><span class="strut">&nbsp;</span></p>
<p id="t256" class="pln"><span class="str">        Returns the sensitivity for each dimension of this kernel.</span><span class="strut">&nbsp;</span></p>
<p id="t257" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t258" class="pln"><span class="str">        This is an arbitrary measurement based on the parameters</span><span class="strut">&nbsp;</span></p>
<p id="t259" class="pln"><span class="str">        of the kernel per dimension and scaling in general.</span><span class="strut">&nbsp;</span></p>
<p id="t260" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t261" class="pln"><span class="str">        Use this as relative measurement, not for absolute comparison between</span><span class="strut">&nbsp;</span></p>
<p id="t262" class="pln"><span class="str">        kernels.</span><span class="strut">&nbsp;</span></p>
<p id="t263" class="pln"><span class="str">        """</span><span class="strut">&nbsp;</span></p>
<p id="t264" class="stm mis">        <span class="key">return</span> <span class="nam">np</span><span class="op">.</span><span class="nam">zeros</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">input_dim</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t265" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t266" class="stm run hide_run">    <span class="key">def</span> <span class="nam">get_most_significant_input_dimensions</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">which_indices</span><span class="op">=</span><span class="key">None</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t267" class="pln">        <span class="str">"""</span><span class="strut">&nbsp;</span></p>
<p id="t268" class="pln"><span class="str">        Determine which dimensions should be plotted</span><span class="strut">&nbsp;</span></p>
<p id="t269" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t270" class="pln"><span class="str">        Returns the top three most signification input dimensions</span><span class="strut">&nbsp;</span></p>
<p id="t271" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t272" class="pln"><span class="str">        if less then three dimensions, the non existing dimensions are</span><span class="strut">&nbsp;</span></p>
<p id="t273" class="pln"><span class="str">        labeled as None, so for a 1 dimensional input this returns</span><span class="strut">&nbsp;</span></p>
<p id="t274" class="pln"><span class="str">        (0, None, None).</span><span class="strut">&nbsp;</span></p>
<p id="t275" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t276" class="pln"><span class="str">        :param which_indices: force the indices to be the given indices.</span><span class="strut">&nbsp;</span></p>
<p id="t277" class="pln"><span class="str">        :type which_indices: int or tuple(int,int) or tuple(int,int,int)</span><span class="strut">&nbsp;</span></p>
<p id="t278" class="pln"><span class="str">        """</span><span class="strut">&nbsp;</span></p>
<p id="t279" class="stm mis">        <span class="key">if</span> <span class="nam">which_indices</span> <span class="key">is</span> <span class="key">None</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t280" class="stm mis">            <span class="nam">which_indices</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">argsort</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">input_sensitivity</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="op">:</span><span class="op">:</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="op">:</span><span class="num">3</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t281" class="stm mis">        <span class="key">try</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t282" class="stm mis">            <span class="nam">input_1</span><span class="op">,</span> <span class="nam">input_2</span><span class="op">,</span> <span class="nam">input_3</span> <span class="op">=</span> <span class="nam">which_indices</span><span class="strut">&nbsp;</span></p>
<p id="t283" class="exc">        <span class="key">except</span> <span class="nam">ValueError</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t284" class="pln">            <span class="com"># which indices is tuple or int</span><span class="strut">&nbsp;</span></p>
<p id="t285" class="exc">            <span class="key">try</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t286" class="exc">                <span class="nam">input_3</span> <span class="op">=</span> <span class="key">None</span><span class="strut">&nbsp;</span></p>
<p id="t287" class="exc">                <span class="nam">input_1</span><span class="op">,</span> <span class="nam">input_2</span> <span class="op">=</span> <span class="nam">which_indices</span><span class="strut">&nbsp;</span></p>
<p id="t288" class="exc">            <span class="key">except</span> <span class="nam">TypeError</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t289" class="pln">                <span class="com"># which_indices is an int</span><span class="strut">&nbsp;</span></p>
<p id="t290" class="exc">                <span class="nam">input_1</span><span class="op">,</span> <span class="nam">input_2</span> <span class="op">=</span> <span class="nam">which_indices</span><span class="op">,</span> <span class="key">None</span><span class="strut">&nbsp;</span></p>
<p id="t291" class="exc">            <span class="key">except</span> <span class="nam">ValueError</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t292" class="pln">                <span class="com"># which_indices was a list or array like with only one int</span><span class="strut">&nbsp;</span></p>
<p id="t293" class="exc">                <span class="nam">input_1</span><span class="op">,</span> <span class="nam">input_2</span> <span class="op">=</span> <span class="nam">which_indices</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">,</span> <span class="key">None</span><span class="strut">&nbsp;</span></p>
<p id="t294" class="stm mis">        <span class="key">return</span> <span class="nam">input_1</span><span class="op">,</span> <span class="nam">input_2</span><span class="op">,</span> <span class="nam">input_3</span><span class="strut">&nbsp;</span></p>
<p id="t295" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t296" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t297" class="stm run hide_run">    <span class="key">def</span> <span class="nam">__add__</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">other</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t298" class="pln">        <span class="str">""" Overloading of the '+' operator. for more control, see self.add """</span><span class="strut">&nbsp;</span></p>
<p id="t299" class="stm mis">        <span class="key">return</span> <span class="nam">self</span><span class="op">.</span><span class="nam">add</span><span class="op">(</span><span class="nam">other</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t300" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t301" class="stm run hide_run">    <span class="key">def</span> <span class="nam">__iadd__</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">other</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t302" class="stm mis">        <span class="key">return</span> <span class="nam">self</span><span class="op">.</span><span class="nam">add</span><span class="op">(</span><span class="nam">other</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t303" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t304" class="stm run hide_run">    <span class="key">def</span> <span class="nam">add</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">other</span><span class="op">,</span> <span class="nam">name</span><span class="op">=</span><span class="str">'sum'</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t305" class="pln">        <span class="str">"""</span><span class="strut">&nbsp;</span></p>
<p id="t306" class="pln"><span class="str">        Add another kernel to this one.</span><span class="strut">&nbsp;</span></p>
<p id="t307" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t308" class="pln"><span class="str">        :param other: the other kernel to be added</span><span class="strut">&nbsp;</span></p>
<p id="t309" class="pln"><span class="str">        :type other: GPy.kern</span><span class="strut">&nbsp;</span></p>
<p id="t310" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t311" class="pln"><span class="str">        """</span><span class="strut">&nbsp;</span></p>
<p id="t312" class="stm mis">        <span class="key">assert</span> <span class="nam">isinstance</span><span class="op">(</span><span class="nam">other</span><span class="op">,</span> <span class="nam">Kern</span><span class="op">)</span><span class="op">,</span> <span class="str">"only kernels can be added to kernels..."</span><span class="strut">&nbsp;</span></p>
<p id="t313" class="stm mis">        <span class="key">from</span> <span class="op">.</span><span class="nam">add</span> <span class="key">import</span> <span class="nam">Add</span><span class="strut">&nbsp;</span></p>
<p id="t314" class="stm mis">        <span class="key">return</span> <span class="nam">Add</span><span class="op">(</span><span class="op">[</span><span class="nam">self</span><span class="op">,</span> <span class="nam">other</span><span class="op">]</span><span class="op">,</span> <span class="nam">name</span><span class="op">=</span><span class="nam">name</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t315" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t316" class="stm run hide_run">    <span class="key">def</span> <span class="nam">__mul__</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">other</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t317" class="pln">        <span class="str">""" Here we overload the '*' operator. See self.prod for more information"""</span><span class="strut">&nbsp;</span></p>
<p id="t318" class="stm mis">        <span class="key">return</span> <span class="nam">self</span><span class="op">.</span><span class="nam">prod</span><span class="op">(</span><span class="nam">other</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t319" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t320" class="stm run hide_run">    <span class="key">def</span> <span class="nam">__imul__</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">other</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t321" class="pln">        <span class="str">""" Here we overload the '*' operator. See self.prod for more information"""</span><span class="strut">&nbsp;</span></p>
<p id="t322" class="stm mis">        <span class="key">return</span> <span class="nam">self</span><span class="op">.</span><span class="nam">prod</span><span class="op">(</span><span class="nam">other</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t323" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t324" class="stm run hide_run">    <span class="key">def</span> <span class="nam">__pow__</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">other</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t325" class="pln">        <span class="str">"""</span><span class="strut">&nbsp;</span></p>
<p id="t326" class="pln"><span class="str">        Shortcut for tensor `prod`.</span><span class="strut">&nbsp;</span></p>
<p id="t327" class="pln"><span class="str">        """</span><span class="strut">&nbsp;</span></p>
<p id="t328" class="stm mis">        <span class="key">assert</span> <span class="nam">np</span><span class="op">.</span><span class="nam">all</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">_all_dims_active</span> <span class="op">==</span> <span class="nam">range</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">input_dim</span><span class="op">)</span><span class="op">)</span><span class="op">,</span> <span class="str">"Can only use kernels, which have their input_dims defined from 0"</span><span class="strut">&nbsp;</span></p>
<p id="t329" class="stm mis">        <span class="key">assert</span> <span class="nam">np</span><span class="op">.</span><span class="nam">all</span><span class="op">(</span><span class="nam">other</span><span class="op">.</span><span class="nam">_all_dims_active</span> <span class="op">==</span> <span class="nam">range</span><span class="op">(</span><span class="nam">other</span><span class="op">.</span><span class="nam">input_dim</span><span class="op">)</span><span class="op">)</span><span class="op">,</span> <span class="str">"Can only use kernels, which have their input_dims defined from 0"</span><span class="strut">&nbsp;</span></p>
<p id="t330" class="stm mis">        <span class="nam">other</span><span class="op">.</span><span class="nam">_all_dims_active</span> <span class="op">+=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">input_dim</span><span class="strut">&nbsp;</span></p>
<p id="t331" class="stm mis">        <span class="key">return</span> <span class="nam">self</span><span class="op">.</span><span class="nam">prod</span><span class="op">(</span><span class="nam">other</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t332" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t333" class="stm run hide_run">    <span class="key">def</span> <span class="nam">prod</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">other</span><span class="op">,</span> <span class="nam">name</span><span class="op">=</span><span class="str">'mul'</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t334" class="pln">        <span class="str">"""</span><span class="strut">&nbsp;</span></p>
<p id="t335" class="pln"><span class="str">        Multiply two kernels (either on the same space, or on the tensor</span><span class="strut">&nbsp;</span></p>
<p id="t336" class="pln"><span class="str">        product of the input space).</span><span class="strut">&nbsp;</span></p>
<p id="t337" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t338" class="pln"><span class="str">        :param other: the other kernel to be added</span><span class="strut">&nbsp;</span></p>
<p id="t339" class="pln"><span class="str">        :type other: GPy.kern</span><span class="strut">&nbsp;</span></p>
<p id="t340" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t341" class="pln"><span class="str">        """</span><span class="strut">&nbsp;</span></p>
<p id="t342" class="stm mis">        <span class="key">assert</span> <span class="nam">isinstance</span><span class="op">(</span><span class="nam">other</span><span class="op">,</span> <span class="nam">Kern</span><span class="op">)</span><span class="op">,</span> <span class="str">"only kernels can be multiplied to kernels..."</span><span class="strut">&nbsp;</span></p>
<p id="t343" class="stm mis">        <span class="key">from</span> <span class="op">.</span><span class="nam">prod</span> <span class="key">import</span> <span class="nam">Prod</span><span class="strut">&nbsp;</span></p>
<p id="t344" class="pln">        <span class="com"># kernels = []</span><span class="strut">&nbsp;</span></p>
<p id="t345" class="pln">        <span class="com"># if isinstance(self, Prod): kernels.extend(self.parameters)</span><span class="strut">&nbsp;</span></p>
<p id="t346" class="pln">        <span class="com"># else: kernels.append(self)</span><span class="strut">&nbsp;</span></p>
<p id="t347" class="pln">        <span class="com"># if isinstance(other, Prod): kernels.extend(other.parameters)</span><span class="strut">&nbsp;</span></p>
<p id="t348" class="pln">        <span class="com"># else: kernels.append(other)</span><span class="strut">&nbsp;</span></p>
<p id="t349" class="stm mis">        <span class="key">return</span> <span class="nam">Prod</span><span class="op">(</span><span class="op">[</span><span class="nam">self</span><span class="op">,</span> <span class="nam">other</span><span class="op">]</span><span class="op">,</span> <span class="nam">name</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t350" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t351" class="stm run hide_run">    <span class="key">def</span> <span class="nam">_check_input_dim</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">X</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t352" class="stm mis">        <span class="key">assert</span> <span class="nam">X</span><span class="op">.</span><span class="nam">shape</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">==</span> <span class="nam">self</span><span class="op">.</span><span class="nam">input_dim</span><span class="op">,</span> <span class="str">"{} did not specify active_dims and X has wrong shape: X_dim={}, whereas input_dim={}"</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">name</span><span class="op">,</span> <span class="nam">X</span><span class="op">.</span><span class="nam">shape</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">,</span> <span class="nam">self</span><span class="op">.</span><span class="nam">input_dim</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t353" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t354" class="stm run hide_run">    <span class="key">def</span> <span class="nam">_check_active_dims</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">X</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t355" class="stm mis">        <span class="key">assert</span> <span class="nam">X</span><span class="op">.</span><span class="nam">shape</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">>=</span> <span class="nam">len</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">_all_dims_active</span><span class="op">)</span><span class="op">,</span> <span class="str">"At least {} dimensional X needed, X.shape={!s}"</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">_all_dims_active</span><span class="op">)</span><span class="op">,</span> <span class="nam">X</span><span class="op">.</span><span class="nam">shape</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t356" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t357" class="stm run hide_run"><span class="key">class</span> <span class="nam">CombinationKernel</span><span class="op">(</span><span class="nam">Kern</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t358" class="pln">    <span class="str">"""</span><span class="strut">&nbsp;</span></p>
<p id="t359" class="pln"><span class="str">    Abstract super class for combination kernels.</span><span class="strut">&nbsp;</span></p>
<p id="t360" class="pln"><span class="str">    A combination kernel combines (a list of) kernels and works on those.</span><span class="strut">&nbsp;</span></p>
<p id="t361" class="pln"><span class="str">    Examples are the HierarchicalKernel or Add and Prod kernels.</span><span class="strut">&nbsp;</span></p>
<p id="t362" class="pln"><span class="str">    """</span><span class="strut">&nbsp;</span></p>
<p id="t363" class="stm run hide_run">    <span class="key">def</span> <span class="nam">__init__</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">kernels</span><span class="op">,</span> <span class="nam">name</span><span class="op">,</span> <span class="nam">extra_dims</span><span class="op">=</span><span class="op">[</span><span class="op">]</span><span class="op">,</span> <span class="nam">link_parameters</span><span class="op">=</span><span class="key">True</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t364" class="pln">        <span class="str">"""</span><span class="strut">&nbsp;</span></p>
<p id="t365" class="pln"><span class="str">        Abstract super class for combination kernels.</span><span class="strut">&nbsp;</span></p>
<p id="t366" class="pln"><span class="str">        A combination kernel combines (a list of) kernels and works on those.</span><span class="strut">&nbsp;</span></p>
<p id="t367" class="pln"><span class="str">        Examples are the HierarchicalKernel or Add and Prod kernels.</span><span class="strut">&nbsp;</span></p>
<p id="t368" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t369" class="pln"><span class="str">        :param list kernels: List of kernels to combine (can be only one element)</span><span class="strut">&nbsp;</span></p>
<p id="t370" class="pln"><span class="str">        :param str name: name of the combination kernel</span><span class="strut">&nbsp;</span></p>
<p id="t371" class="pln"><span class="str">        :param array-like extra_dims: if needed extra dimensions for the combination kernel to work on</span><span class="strut">&nbsp;</span></p>
<p id="t372" class="pln"><span class="str">        """</span><span class="strut">&nbsp;</span></p>
<p id="t373" class="stm mis">        <span class="key">assert</span> <span class="nam">all</span><span class="op">(</span><span class="op">[</span><span class="nam">isinstance</span><span class="op">(</span><span class="nam">k</span><span class="op">,</span> <span class="nam">Kern</span><span class="op">)</span> <span class="key">for</span> <span class="nam">k</span> <span class="key">in</span> <span class="nam">kernels</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t374" class="stm mis">        <span class="nam">extra_dims</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">asarray</span><span class="op">(</span><span class="nam">extra_dims</span><span class="op">,</span> <span class="nam">dtype</span><span class="op">=</span><span class="nam">int</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t375" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t376" class="stm mis">        <span class="nam">active_dims</span> <span class="op">=</span> <span class="nam">reduce</span><span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">union1d</span><span class="op">,</span> <span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">r_</span><span class="op">[</span><span class="nam">x</span><span class="op">.</span><span class="nam">active_dims</span><span class="op">]</span> <span class="key">for</span> <span class="nam">x</span> <span class="key">in</span> <span class="nam">kernels</span><span class="op">)</span><span class="op">,</span> <span class="nam">extra_dims</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t377" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t378" class="stm mis">        <span class="nam">input_dim</span> <span class="op">=</span> <span class="nam">active_dims</span><span class="op">.</span><span class="nam">size</span><span class="strut">&nbsp;</span></p>
<p id="t379" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t380" class="pln">        <span class="com"># initialize the kernel with the full input_dim</span><span class="strut">&nbsp;</span></p>
<p id="t381" class="stm mis">        <span class="nam">super</span><span class="op">(</span><span class="nam">CombinationKernel</span><span class="op">,</span> <span class="nam">self</span><span class="op">)</span><span class="op">.</span><span class="nam">__init__</span><span class="op">(</span><span class="nam">input_dim</span><span class="op">,</span> <span class="nam">active_dims</span><span class="op">,</span> <span class="nam">name</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t382" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t383" class="stm mis">        <span class="nam">effective_input_dim</span> <span class="op">=</span> <span class="nam">reduce</span><span class="op">(</span><span class="nam">max</span><span class="op">,</span> <span class="op">(</span><span class="nam">k</span><span class="op">.</span><span class="nam">_all_dims_active</span><span class="op">.</span><span class="nam">max</span><span class="op">(</span><span class="op">)</span> <span class="key">for</span> <span class="nam">k</span> <span class="key">in</span> <span class="nam">kernels</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="num">1</span><span class="strut">&nbsp;</span></p>
<p id="t384" class="stm mis">        <span class="nam">self</span><span class="op">.</span><span class="nam">_all_dims_active</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">array</span><span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">concatenate</span><span class="op">(</span><span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">arange</span><span class="op">(</span><span class="nam">effective_input_dim</span><span class="op">)</span><span class="op">,</span> <span class="nam">extra_dims</span> <span class="key">if</span> <span class="nam">extra_dims</span> <span class="key">is</span> <span class="key">not</span> <span class="key">None</span> <span class="key">else</span> <span class="op">[</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">,</span> <span class="nam">dtype</span><span class="op">=</span><span class="nam">int</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t385" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t386" class="stm mis">        <span class="nam">self</span><span class="op">.</span><span class="nam">extra_dims</span> <span class="op">=</span> <span class="nam">extra_dims</span><span class="strut">&nbsp;</span></p>
<p id="t387" class="stm mis">        <span class="key">if</span> <span class="nam">link_parameters</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t388" class="stm mis">            <span class="nam">self</span><span class="op">.</span><span class="nam">link_parameters</span><span class="op">(</span><span class="op">*</span><span class="nam">kernels</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t389" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t390" class="stm run hide_run">    <span class="key">def</span> <span class="nam">_save_to_input_dict</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t391" class="stm mis">        <span class="nam">input_dict</span> <span class="op">=</span> <span class="nam">super</span><span class="op">(</span><span class="nam">CombinationKernel</span><span class="op">,</span> <span class="nam">self</span><span class="op">)</span><span class="op">.</span><span class="nam">_save_to_input_dict</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t392" class="stm mis">        <span class="nam">input_dict</span><span class="op">[</span><span class="str">"parts"</span><span class="op">]</span>  <span class="op">=</span> <span class="op">{</span><span class="op">}</span><span class="strut">&nbsp;</span></p>
<p id="t393" class="stm mis">        <span class="key">for</span> <span class="nam">ii</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">parts</span><span class="op">)</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t394" class="stm mis">            <span class="nam">input_dict</span><span class="op">[</span><span class="str">"parts"</span><span class="op">]</span><span class="op">[</span><span class="nam">ii</span><span class="op">]</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">parts</span><span class="op">[</span><span class="nam">ii</span><span class="op">]</span><span class="op">.</span><span class="nam">to_dict</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t395" class="stm mis">        <span class="key">return</span> <span class="nam">input_dict</span><span class="strut">&nbsp;</span></p>
<p id="t396" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t397" class="stm run hide_run">    <span class="op">@</span><span class="nam">staticmethod</span><span class="strut">&nbsp;</span></p>
<p id="t398" class="pln">    <span class="key">def</span> <span class="nam">_build_from_input_dict</span><span class="op">(</span><span class="nam">kernel_class</span><span class="op">,</span> <span class="nam">input_dict</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t399" class="stm mis">        <span class="nam">parts</span> <span class="op">=</span> <span class="nam">input_dict</span><span class="op">.</span><span class="nam">pop</span><span class="op">(</span><span class="str">'parts'</span><span class="op">,</span> <span class="key">None</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t400" class="stm mis">        <span class="nam">subkerns</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t401" class="stm mis">        <span class="key">for</span> <span class="nam">pp</span> <span class="key">in</span> <span class="nam">parts</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t402" class="stm mis">            <span class="nam">subkerns</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">Kern</span><span class="op">.</span><span class="nam">from_dict</span><span class="op">(</span><span class="nam">parts</span><span class="op">[</span><span class="nam">pp</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t403" class="stm mis">        <span class="key">return</span> <span class="nam">kernel_class</span><span class="op">(</span><span class="nam">subkerns</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t404" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t405" class="stm run hide_run">    <span class="op">@</span><span class="nam">property</span><span class="strut">&nbsp;</span></p>
<p id="t406" class="pln">    <span class="key">def</span> <span class="nam">parts</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t407" class="stm mis">        <span class="key">return</span> <span class="nam">self</span><span class="op">.</span><span class="nam">parameters</span><span class="strut">&nbsp;</span></p>
<p id="t408" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t409" class="stm run hide_run">    <span class="key">def</span> <span class="nam">_set_all_dims_ative</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t410" class="stm mis">        <span class="nam">self</span><span class="op">.</span><span class="nam">_all_dims_active</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">atleast_1d</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">active_dims</span><span class="op">)</span><span class="op">.</span><span class="nam">astype</span><span class="op">(</span><span class="nam">int</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t411" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t412" class="stm run hide_run">    <span class="key">def</span> <span class="nam">input_sensitivity</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">summarize</span><span class="op">=</span><span class="key">True</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t413" class="pln">        <span class="str">"""</span><span class="strut">&nbsp;</span></p>
<p id="t414" class="pln"><span class="str">        If summize is true, we want to get the summerized view of the sensitivities,</span><span class="strut">&nbsp;</span></p>
<p id="t415" class="pln"><span class="str">        otherwise put everything into an array with shape (#kernels, input_dim)</span><span class="strut">&nbsp;</span></p>
<p id="t416" class="pln"><span class="str">        in the order of appearance of the kernels in the parameterized object.</span><span class="strut">&nbsp;</span></p>
<p id="t417" class="pln"><span class="str">        """</span><span class="strut">&nbsp;</span></p>
<p id="t418" class="stm mis">        <span class="key">if</span> <span class="key">not</span> <span class="nam">summarize</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t419" class="stm mis">            <span class="nam">num_params</span> <span class="op">=</span> <span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t420" class="stm mis">            <span class="nam">parts</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t421" class="stm mis">            <span class="key">def</span> <span class="nam">sum_params</span><span class="op">(</span><span class="nam">x</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t422" class="stm mis">                <span class="key">if</span> <span class="op">(</span><span class="key">not</span> <span class="nam">isinstance</span><span class="op">(</span><span class="nam">x</span><span class="op">,</span> <span class="nam">CombinationKernel</span><span class="op">)</span><span class="op">)</span> <span class="key">and</span> <span class="nam">isinstance</span><span class="op">(</span><span class="nam">x</span><span class="op">,</span> <span class="nam">Kern</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t423" class="stm mis">                    <span class="nam">num_params</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">+=</span> <span class="num">1</span><span class="strut">&nbsp;</span></p>
<p id="t424" class="stm mis">                    <span class="nam">parts</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">x</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t425" class="stm mis">            <span class="nam">self</span><span class="op">.</span><span class="nam">traverse</span><span class="op">(</span><span class="nam">sum_params</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t426" class="stm mis">            <span class="nam">i_s</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">zeros</span><span class="op">(</span><span class="op">(</span><span class="nam">num_params</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">,</span> <span class="nam">self</span><span class="op">.</span><span class="nam">input_dim</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t427" class="stm mis">            <span class="key">from</span> <span class="nam">operator</span> <span class="key">import</span> <span class="nam">setitem</span><span class="strut">&nbsp;</span></p>
<p id="t428" class="stm mis">            <span class="op">[</span><span class="nam">setitem</span><span class="op">(</span><span class="nam">i_s</span><span class="op">,</span> <span class="op">(</span><span class="nam">i</span><span class="op">,</span> <span class="nam">k</span><span class="op">.</span><span class="nam">_all_dims_active</span><span class="op">)</span><span class="op">,</span> <span class="nam">k</span><span class="op">.</span><span class="nam">input_sensitivity</span><span class="op">(</span><span class="nam">summarize</span><span class="op">)</span><span class="op">)</span> <span class="key">for</span> <span class="nam">i</span><span class="op">,</span> <span class="nam">k</span> <span class="key">in</span> <span class="nam">enumerate</span><span class="op">(</span><span class="nam">parts</span><span class="op">)</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t429" class="stm mis">            <span class="key">return</span> <span class="nam">i_s</span><span class="strut">&nbsp;</span></p>
<p id="t430" class="pln">        <span class="key">else</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t431" class="exc">            <span class="key">raise</span> <span class="nam">NotImplementedError</span><span class="op">(</span><span class="str">"Choose the kernel you want to get the sensitivity for. You need to override the default behaviour for getting the input sensitivity to be able to get the input sensitivity. For sum kernel it is the sum of all sensitivities, TODO: product kernel? Other kernels?, also TODO: shall we return all the sensitivities here in the combination kernel? So we can combine them however we want? This could lead to just plot all the sensitivities here..."</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t432" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t433" class="stm run hide_run">    <span class="key">def</span> <span class="nam">_check_active_dims</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">X</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t434" class="stm mis">        <span class="key">return</span><span class="strut">&nbsp;</span></p>
<p id="t435" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t436" class="stm run hide_run">    <span class="key">def</span> <span class="nam">_check_input_dim</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">X</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t437" class="pln">        <span class="com"># As combination kernels cannot always know, what their inner kernels have as input dims, the check will be done inside them, respectively</span><span class="strut">&nbsp;</span></p>
<p id="t438" class="stm mis">        <span class="key">return</span><span class="strut">&nbsp;</span></p>

            </td>
        </tr>
    </table>
</div>

<div id="footer">
    <div class="content">
        <p>
            <a class="nav" href="index.html">&#xab; index</a> &nbsp; &nbsp; <a class="nav" href="https://coverage.readthedocs.io">coverage.py v4.5.1</a>,
            created at 2018-09-12 14:18
        </p>
    </div>
</div>

</body>
</html>
